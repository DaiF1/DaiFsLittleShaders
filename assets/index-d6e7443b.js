(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const v of o.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&r(v)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();function q(t){const e=t.clientWidth,n=t.clientHeight,r=t.width!==e||t.height!==n;return r&&(t.width=e,t.height=n),r}function tt(t,e,n){var r=t.createShader(e);t.shaderSource(r,n),t.compileShader(r);var a=t.getShaderParameter(r,t.COMPILE_STATUS);if(a)return r;var o="vertex";e===t.FRAGMENT_SHADER&&(o="fragment"),console.log(n),console.log(o,t.getShaderInfoLog(r)),t.deleteShader(r)}function ot(t,e,n){var r=t.createProgram();t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r);var a=t.getProgramParameter(r,t.LINK_STATUS);if(a)return r;console.log(t.getProgramInfoLog(r)),t.deleteProgram(r)}var H={},nt={};function it(t,e){Object.keys(e).forEach(n=>{if(!H[e[n].vertex]){var r=document.querySelector("#"+e[n].vertex).text;H[e[n].vertex]=tt(t,t.VERTEX_SHADER,r)}if(!H[e[n].fragment]){var r=document.querySelector("#"+e[n].fragment).text;H[e[n].fragment]=tt(t,t.FRAGMENT_SHADER,r)}nt[n]=ot(t,H[e[n].vertex],H[e[n].fragment])})}function st(t,e){t.useProgram(K(e))}function K(t){return nt[t]}var z={};function ct(t,e,n){z[e]||(z[e]={}),Object.keys(n).forEach(r=>{z[e][r]||(z[e][r]=t.getAttribLocation(K(e),r)),t.bindBuffer(t.ARRAY_BUFFER,n[r].buffer),t.enableVertexAttribArray(z[e][r]),t.vertexAttribPointer(z[e][r],n[r].numComponents,t.FLOAT,!1,0,0)})}var M={};function V(t,e,n){M[e]||(M[e]={}),st(t,e),Object.keys(n).forEach(r=>{switch(M[e][r]||(M[e][r]=t.getUniformLocation(K(e),r)),n[r].type){case"int1":t.uniform1i(M[e][r],n[r].data);break;case"float1":t.uniform1f(M[e][r],n[r].data);break;case"vec3":t.uniform3fv(M[e][r],n[r].data);break;case"mat4":t.uniformMatrix4fv(M[e][r],!1,n[r].data);break}})}function ut(t,e){let n;if(t.indexOf("coord")>=0?n=2:t.indexOf("color")>=0?n=4:n=3,e%n>0)throw"can not guess numComponents. You should specify it.";return n}function ft(t,e){return t.numComponents||t.size||ut(e,at(t).length)}function at(t){return t.length?t:t.data}function vt(t){let e;const n=["position","positions","a_position"];for(const p of n)if(p in t){e=p;break}e=e||Object.keys(t)[0];const r=t[e],a=at(r).length,o=ft(r,e),v=a/o;if(a%o>0)throw new Error(`numComponents ${o} not correct for length ${a}`);return v}function et(t,e){var n={};return n.numElements=vt(e),n.attribs={},Object.keys(e).forEach(r=>{n.attribs["a_"+r]={},n.attribs["a_"+r].buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n.attribs["a_"+r].buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e[r]),t.STATIC_DRAW),n.attribs["a_"+r].numComponents=3}),n.attribs.a_texcoord.numComponents=2,n}function Y(t,e,n){ct(t,e,n.attribs)}var c={identity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},perspective:function(t,e,n,r){var a=Math.tan(Math.PI*.5-.5*t),o=1/(n-r);return[a/e,0,0,0,0,a,0,0,0,0,(n+r)*o,-1,0,0,n*r*o*2,0]},orthographic:function(t,e,n,r,a,o){return[2/(e-t),0,0,0,0,2/(r-n),0,0,0,0,2/(a-o),0,(t+e)/(t-e),(n+r)/(n-r),(a+o)/(a-o),1]},translation:function(t,e,n){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,n,1]},xRotation:function(t){var e=Math.cos(t),n=Math.sin(t);return[1,0,0,0,0,e,n,0,0,-n,e,0,0,0,0,1]},yRotation:function(t){var e=Math.cos(t),n=Math.sin(t);return[e,0,-n,0,0,1,0,0,n,0,e,0,0,0,0,1]},zRotation:function(t){var e=Math.cos(t),n=Math.sin(t);return[e,n,0,0,-n,e,0,0,0,0,1,0,0,0,0,1]},scaling:function(t,e,n){return[t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1]},multiply:function(t,e){var n=e[0],r=e[0*4+1],a=e[0*4+2],o=e[0*4+3],v=e[1*4+0],p=e[1*4+1],T=e[1*4+2],d=e[1*4+3],s=e[2*4+0],u=e[2*4+1],f=e[2*4+2],i=e[2*4+3],m=e[3*4+0],l=e[3*4+1],_=e[3*4+2],P=e[3*4+3],R=t[0*4+0],b=t[0*4+1],C=t[0*4+2],y=t[0*4+3],h=t[1*4+0],U=t[1*4+1],B=t[1*4+2],A=t[1*4+3],F=t[2*4+0],I=t[2*4+1],w=t[2*4+2],O=t[2*4+3],D=t[3*4+0],L=t[3*4+1],S=t[3*4+2],E=t[3*4+3];return[n*R+r*h+a*F+o*D,n*b+r*U+a*I+o*L,n*C+r*B+a*w+o*S,n*y+r*A+a*O+o*E,v*R+p*h+T*F+d*D,v*b+p*U+T*I+d*L,v*C+p*B+T*w+d*S,v*y+p*A+T*O+d*E,s*R+u*h+f*F+i*D,s*b+u*U+f*I+i*L,s*C+u*B+f*w+i*S,s*y+u*A+f*O+i*E,m*R+l*h+_*F+P*D,m*b+l*U+_*I+P*L,m*C+l*B+_*w+P*S,m*y+l*A+_*O+P*E]},cross:function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},subtractVectors:function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},normalize:function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return e>1e-5?[t[0]/e,t[1]/e,t[2]/e]:[0,0,0]},lookAt:function(t,e,n){var r=c.normalize(c.subtractVectors(t,e)),a=c.normalize(c.cross(n,r)),o=c.normalize(c.cross(r,a));return[a[0],a[1],a[2],0,o[0],o[1],o[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],1]},translate:function(t,e,n,r){return c.multiply(t,c.translation(e,n,r))},xRotate:function(t,e){return c.multiply(t,c.xRotation(e))},yRotate:function(t,e){return c.multiply(t,c.yRotation(e))},zRotate:function(t,e){return c.multiply(t,c.zRotation(e))},scale:function(t,e,n,r){return c.multiply(t,c.scaling(e,n,r))},inverse:function(t){var e=t[0],n=t[0*4+1],r=t[0*4+2],a=t[0*4+3],o=t[1*4+0],v=t[1*4+1],p=t[1*4+2],T=t[1*4+3],d=t[2*4+0],s=t[2*4+1],u=t[2*4+2],f=t[2*4+3],i=t[3*4+0],m=t[3*4+1],l=t[3*4+2],_=t[3*4+3],P=u*_,R=l*f,b=p*_,C=l*T,y=p*f,h=u*T,U=r*_,B=l*a,A=r*f,F=u*a,I=r*T,w=p*a,O=d*m,D=i*s,L=o*m,S=i*v,E=o*s,X=d*v,N=e*m,G=i*n,k=e*s,g=d*n,j=e*v,W=o*n,$=P*v+C*s+y*m-(R*v+b*s+h*m),J=R*n+U*s+F*m-(P*n+B*s+A*m),Q=b*n+B*v+I*m-(C*n+U*v+w*m),Z=h*n+A*v+w*s-(y*n+F*v+I*s),x=1/(e*$+o*J+d*Q+i*Z);return[x*$,x*J,x*Q,x*Z,x*(R*o+b*d+h*i-(P*o+C*d+y*i)),x*(P*e+B*d+A*i-(R*e+U*d+F*i)),x*(C*e+U*o+w*i-(b*e+B*o+I*i)),x*(y*e+F*o+I*d-(h*e+A*o+w*d)),x*(O*T+S*f+E*_-(D*T+L*f+X*_)),x*(D*a+N*f+g*_-(O*a+G*f+k*_)),x*(L*a+G*T+j*_-(S*a+N*T+W*_)),x*(X*a+k*T+W*f-(E*a+g*T+j*f)),x*(L*u+X*l+D*p-(E*l+O*p+S*u)),x*(k*l+O*r+G*u-(N*u+g*l+D*r)),x*(N*p+W*l+S*r-(j*l+L*r+G*p)),x*(j*u+E*r+g*p-(k*p+W*u+X*r))]},transpose:function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},vectorMultiply:function(t,e){for(var n=[],r=0;r<4;++r){n[r]=0;for(var a=0;a<4;++a)n[r]+=t[a]*e[a*4+r]}return n}};function dt(t){const e=[[0,0,0]],n=[[0,0]],r=[[0,0,0]],a=[e,n,r];let o=[[],[],[]];function v(s){s.split("/").forEach((f,i)=>{if(!f)return;const m=parseInt(f),l=m+(m>=0?0:a[i].length);o[i].push(...a[i][l])})}const p={v(s){e.push(s.map(parseFloat))},vn(s){r.push(s.map(parseFloat))},vt(s){n.push(s.map(parseFloat))},f(s){const u=s.length-2;for(let f=0;f<u;++f)v(s[0]),v(s[f+1]),v(s[f+2])}},T=/(\w*)(?: )*(.*)/,d=t.split(`
`);for(let s=0;s<d.length;++s){const u=d[s].trim();if(u===""||u.startsWith("#"))continue;const f=T.exec(u);if(!f)continue;const[,i,m]=f,l=u.split(/\s+/).slice(1),_=p[i];if(!_){console.warn("unhandled keyword:",i,"at line",s+1);continue}_(l,m)}return{position:o[0],texcoord:o[1],normal:o[2]}}function rt(t,e,n,r){const a=t.createTexture();t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,a);const o=0,v=t.RGBA,p=0,T=t.RGBA,d=t.UNSIGNED_BYTE,s=null;t.texImage2D(t.TEXTURE_2D,o,v,n,r,p,T,d,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const u=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,u);const f=t.COLOR_ATTACHMENT0;t.framebufferTexture2D(t.FRAMEBUFFER,f,t.TEXTURE_2D,a,o);var i={frameBuffer:u,texture:a,width:n,height:r};return i}function mt(t,e){var n=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));var r=new Image;r.src=e,r.addEventListener("load",()=>{t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.generateMipmap(t.TEXTURE_2D)})}async function pt(){var t=document.querySelector("#c"),e=t.getContext("webgl");e||console.log("ERROR: Failed to initialize webgl");var n={depth:{vertex:"vertex-depth",fragment:"fragment-depth"},default:{vertex:"default-vertex",fragment:"default-fragment"},gooch:{vertex:"default-vertex",fragment:"gooch-fragment"},comics:{vertex:"default-vertex",fragment:"comics-fragment"},postp_default:{vertex:"default-vertex-postp",fragment:"default-fragment-postp"},postp_gooch:{vertex:"default-vertex-postp",fragment:"outline-fragment-postp"},postp_comics:{vertex:"default-vertex-postp",fragment:"outline-fragment-postp"}};it(e,n);var r="default",a=document.querySelector("#shader-select");a.addEventListener("change",()=>{r=a.value,o(r),y()});function o(h){Y(e,h,d),V(e,h,s)}var p=await(await fetch("resources/tree.obj")).text();const T=dt(p);var d=et(e,T),s={u_reverseLightDir:{data:c.normalize([.5,.7,-1]),type:"vec3"}},u={u_world:{data:c.identity(),type:"mat4"},u_worldViewMatrix:{data:c.identity(),type:"mat4"},u_texture:{data:0,type:"int1"}},f={u_width:{data:e.canvas.clientWidth,type:"float1"},u_height:{data:e.canvas.clientHeight,type:"float1"},u_depthTexture:{data:1,type:"int1"},u_screenTexture:{data:2,type:"int1"}};Y(e,r,d),V(e,r,s);function i(h){return h*Math.PI/180}var m=[{translation:[0,0,-23],rotation:[i(0),i(0),i(0)],scale:[2,2,2]},{translation:[0,0,25],rotation:[i(0),i(0),i(0)],scale:[2,2,2]},{translation:[10,0,20],rotation:[i(0),i(0),i(0)],scale:[2,2,2]},{translation:[-11,0,-22],rotation:[i(0),i(0),i(0)],scale:[2,2,2]},{translation:[23,0,0],rotation:[i(0),i(0),i(0)],scale:[2,2,2]},{translation:[-22,0,-1],rotation:[i(0),i(0),i(0)],scale:[2,2,2]}],l=0,_=0,P=.01;addEventListener("mousemove",h=>{_+=h.movementX*P,l=Math.max(Math.min(l+h.movementY*P,i(60)),i(-50)),y()}),mt(e,"./resources/palette.png");var R=rt(e,e.TEXTURE1,e.canvas.clientWidth,e.canvas.clientHeight),b=rt(e,e.TEXTURE2,e.canvas.clientWidth,e.canvas.clientHeight);function C(h){var U=i(60),B=1,A=2e3,F=c.yRotation(_);F=c.xRotate(F,l),F=c.translate(F,0,10,0);var I=c.inverse(F),w=c.perspective(U,h,B,A),O=c.multiply(w,I);for(let N=0;N<m.length;N++){var D=m[N].translation,L=m[N].rotation,S=m[N].scale,E=c.identity();E=c.translate(E,D[0],D[1],D[2]),E=c.xRotate(E,L[0]),E=c.yRotate(E,L[1]),E=c.zRotate(E,L[2]),E=c.scale(E,S[0],S[1],S[2]);var X=c.multiply(O,E);u.u_worldViewMatrix.data=X,u.u_world.data=E,Y(e,r,d),V(e,r,u),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.drawArrays(e.TRIANGLES,0,d.numElements)}}function y(){{e.bindFramebuffer(e.FRAMEBUFFER,R.frameBuffer),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,R.texture);var h=r;r="depth",o(r),q(e.canvas),e.viewport(0,0,R.width,R.height),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST);const A=R.width/R.height;C(A),r=h}{e.bindFramebuffer(e.FRAMEBUFFER,b.frameBuffer),o(r),q(e.canvas),e.viewport(0,0,b.width,b.height),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST);const A=b.width/b.height;C(A)}{e.bindFramebuffer(e.FRAMEBUFFER,null),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,R.texture),q(e.canvas),e.viewport(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.canvas.clientWidth/e.canvas.clientHeight;var U={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0],texcoord:[0,0,1,0,0,1,0,1,1,0,1,1]},B=et(e,U);V(e,"postp_"+r,f),Y(e,"postp_"+r,B),e.drawArrays(e.TRIANGLES,0,6)}}y()}pt();
